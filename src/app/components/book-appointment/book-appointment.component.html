<div class="container">
  <button class="back-button" (click)="goBack()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="19" y1="12" x2="5" y2="12"></line>
      <polyline points="12 19 5 12 12 5"></polyline>
    </svg>
    Back to Slots
  </button>

  <div class="booking-wrapper">
    <div class="slot-details-card">
      <h2>Appointment Details</h2>
      
      @if (selectedSlot()) {
        <div class="slot-info">
          <div class="info-item">
            <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <div>
              <span class="info-label">Date</span>
              <span class="info-value">{{ formatDate(selectedSlot()!.date) }}</span>
            </div>
          </div>

          <div class="info-item">
            <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <div>
              <span class="info-label">Time</span>
              <span class="info-value">{{ formatTime(selectedSlot()!.startTime) }} - {{ formatTime(selectedSlot()!.endTime) }}</span>
            </div>
          </div>

          <div class="info-item">
            <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <div>
              <span class="info-label">Provider</span>
              <span class="info-value">{{ selectedSlot()!.providerName }}</span>
            </div>
          </div>
        </div>
      } @else {
        <div class="loading-slot">
          <div class="spinner-small"></div>
          <p>Loading slot details...</p>
        </div>
      }
    </div>

    <div class="booking-form-card">
      <h1>Book Your Appointment</h1>
      <p class="form-subtitle">Please fill in your details to complete the booking</p>

      @if (bookingError()) {
        <div class="error-banner" role="alert">
          <svg class="error-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <span>{{ bookingError() }}</span>
        </div>
      }

      @if (bookingSuccess()) {
        <div class="success-banner" role="alert">
          <svg class="success-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          <div>
            <strong>Booking Successful!</strong>
            <p>Redirecting to confirmation page...</p>
          </div>
        </div>
      }

      <form [formGroup]="bookingForm" (ngSubmit)="onSubmit()" class="booking-form">
        <div class="form-group">
          <label for="customerName" class="form-label">
            Full Name <span class="required">*</span>
          </label>
          <input
            type="text"
            id="customerName"
            formControlName="customerName"
            class="form-input"
            [class.invalid]="isFieldInvalid('customerName')"
            placeholder="Enter your full name"
          />
          @if (isFieldInvalid('customerName')) {
            <span class="error-message">{{ getErrorMessage('customerName') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="customerEmail" class="form-label">
            Email Address <span class="required">*</span>
          </label>
          <input
            type="email"
            id="customerEmail"
            formControlName="customerEmail"
            class="form-input"
            [class.invalid]="isFieldInvalid('customerEmail')"
            placeholder="your.email@example.com"
          />
          @if (isFieldInvalid('customerEmail')) {
            <span class="error-message">{{ getErrorMessage('customerEmail') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="customerPhone" class="form-label">
            Phone Number <span class="required">*</span>
          </label>
          <input
            type="tel"
            id="customerPhone"
            formControlName="customerPhone"
            class="form-input"
            [class.invalid]="isFieldInvalid('customerPhone')"
            placeholder="+1 (555) 123-4567"
          />
          @if (isFieldInvalid('customerPhone')) {
            <span class="error-message">{{ getErrorMessage('customerPhone') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="serviceType" class="form-label">
            Service Type <span class="required">*</span>
          </label>
          <select
            id="serviceType"
            formControlName="serviceType"
            class="form-input"
            [class.invalid]="isFieldInvalid('serviceType')"
          >
            <option value="">Select a service type</option>
            @for (service of serviceTypes; track service) {
              <option [value]="service">{{ service }}</option>
            }
          </select>
          @if (isFieldInvalid('serviceType')) {
            <span class="error-message">{{ getErrorMessage('serviceType') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="notes" class="form-label">
            Additional Notes <span class="optional">(Optional)</span>
          </label>
          <textarea
            id="notes"
            formControlName="notes"
            class="form-input textarea"
            rows="4"
            placeholder="Any special requirements or additional information..."
          ></textarea>
        </div>

        <button
          type="submit"
          class="submit-button"
          [disabled]="loading() || bookingSuccess()"
        >
          @if (loading()) {
            <div class="button-spinner"></div>
            <span>Booking...</span>
          } @else if (bookingSuccess()) {
            <svg class="button-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            <span>Booked Successfully</span>
          } @else {
            <svg class="button-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            <span>Confirm Booking</span>
          }
        </button>
      </form>
    </div>
  </div>
</div>
